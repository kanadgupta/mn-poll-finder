{{!-- DO NOT LET PRETTIER REMOVE THIS --}}
<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <link rel='icon' href='https://fav.farm/üó≥Ô∏è' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />

    <title>{{seo.title}}</title>

    <!-- Meta tags for SEO and social sharing -->
    <link rel='canonical' href='{{seo.url}}' />
    <meta name='description' content='{{seo.description}}' />
    <meta property='og:title' content='{{seo.title}}' />
    <meta property='og:type' content='article' />
    <meta property='og:url' content='{{seo.url}}' />
    <meta property='og:description' content='{{seo.description}}' />
    <meta name='twitter:card' content='summary' />

    <!-- Import the webpage's stylesheet -->
    <link rel='stylesheet' href='/style.css' />
  </head>
  <body>
    <div class='wrapper'>
      <div class='content' role='main'>

        <!-- This is the start of content for our page -->
        <h1 class='title'>MPLS 2021 Poll Finder</h1>

        <!-- Add text indicating that we've found the precinct OR had an error -->
        {{#if precinct}}
          {{#if mplsPollingPlace21.address}}
            <p class='precinct-info'>
              The polling place for
              <b><a href='{{gmaps}}' rel='noopener' target='_blank'>{{address}}</a></b>
              is...<br /><br />
              <b>üó≥Ô∏è
                <a href='{{mplsPollingPlace21.gmapsUrl}}' rel='noopener' target='_blank'>{{mplsPollingPlace21.building}}
                  -
                  {{mplsPollingPlace21.address}}</a></b>
            </p>
            <p class='precinct-info'>
              Before you vote, it might be helpful to know a few things...
            </p>
          {{else}}
            <p class='precinct-info'>
              Hmm...
              <b><a href='{{gmaps}}' rel='noopener' target='_blank'>{{address}}</a></b>
              doesn't appear to be in Minneapolis!<br /><br />In any case, here's some info about your electoral
              boundaries!
            </p>
          {{/if}}
          <ul class='precinct-info'>
            <li><b>Precinct:</b> {{precinct.Precinct}}</li>
            <li><b>Park Board District:</b> {{precinct.Park}}</li>
            <li class='extra hidden'><b>U.S. Congressional District:</b> {{precinct.CongDist}}</li>
            <li class='extra hidden'><b>County:</b> {{precinct.County}}</li>
            <li class='extra hidden'><b>County Commissioner District:</b> {{precinct.CtyComDist}}</li>
            <li class='extra hidden'><b>State Senate District:</b> {{precinct.MNSenDist}}</li>
            <li class='extra hidden'><b>State Legislative District:</b> {{precinct.MNLegDist}}</li>
            <li class='extra hidden'><b>State Judicial District:</b> {{precinct.Judicial}}</li>
            {{!-- <li class='extra hidden'><b>Minor Civil Division (MCD):</b> {{precinct.MCDName}}</li> --}}
            {{!-- <li class="extra hidden"><b>Soil and Water District:</b> {{precinct.SoilAndWater}}</li> --}}
            {{!-- <li class="extra hidden"><b>Hospital District:</b> {{precinct.Hospital}}</li> --}}
            {{!-- <li class='extra hidden'><b>County ID:</b> {{precinct.CountyID}}</li> --}}
            {{!-- <li class='extra hidden'><b>MCD Code:</b> {{precinct.MCDCode}}</li> --}}
            {{!-- <li class='extra hidden'><b>Precinct Code:</b> {{precinct.PrecinctCode}}</li> --}}
            <li><a aria-expanded='false' onclick='toggleInfo(event)' href=''>Show More...</a></li>
          </ul>
        {{/if}}

        {{#if error}}
          <p class='precinct-info'>
            <!-- The server script passes error if the user submission can't be matched -->
            Hmm...
            <b>{{error.message}}</b>
            {{#if error.suggestion}}
              {{error.suggestion}}
            {{/if}}
          </p>
          {{#if error.addresses}}
            <ul class='precinct-info'>
              {{#each error.addresses}}
                <li><a href='{{this.href}}'>{{this.text}}</a></li>
              {{/each}}
            </ul>
          {{/if}}
        {{/if}}

        <div class='form-wrapper'>

          <!-- Our default paragraph/message -->
          {{#unless error}}
            {{#unless precinct}}
              <p>
                The open-source, API-backed poll finder that Steve Simon never built üíî
              </p>
            {{/unless}}
          {{/unless}}
          <form class='address-form' method='get'>
            <label for='address'>
              {{#if precinct}}
                Let's try another address!<br />
              {{else}}
                {{#if error}}
                  Let's try again!<br />
                {{else}}
                  What's your address?<br />
                {{/if}}
              {{/if}}
              <input id='address' name='address' required='required' type='text' value='{{error.query}}' />
            </label>
            <button type='submit'>Submit</button>
          </form>

          <form class='address-form' onsubmit='submitCurrentLocation(event)'>
            <label for='currentLocation'>
              Or, try looking it up for your current location!
              <i>(experimental)</i><br />
              <button id='currentLocation' type='submit'>Current Location</button>
            </label>
          </form>
          <br />Need an example?
          <a href='?example=go'>Click here!</a>
        </div>

        <div class='instructions'>
          <h2>
            Using this project
        <!-- FAQ -->
          </h2>
          <p>
            This is the Glitch
            <strong>Hello Node</strong>
            project. You can use it to build your own app. Check out README.md in the editor for more info and next
            steps you can take!
          </p>
        </div>

      </div>
    </div>
    {{! prettier-ignore }}
    <script>
      function submitCurrentLocation(e) {
        e.preventDefault();
        e.submitter.innerText = "Loading...";
        e.submitter.setAttribute('disabled', 'disabled');
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const long = position.coords.longitude;

          const queryString = new URLSearchParams({ lat, long });
          const pageUrl = '?' + queryString.toString();
          window.history.pushState('', '', pageUrl);

          window.location.reload();
          window.scrollTo(0, 0);
        });
      } 

      function toggleInfo(e) {
        e.preventDefault();
        // Toggle display of every hidden item
        document.querySelectorAll('li.extra').forEach(item => {
          item.classList.toggle('hidden');
        });
        // Update attributes on toggle element
        const isHidden = document.querySelector('li.extra').classList.contains('hidden');
        e.target.innerText = isHidden ? 'Show More...' : 'Show Less...';
        e.target.setAttribute('aria-expanded', !isHidden);
      }
    </script>
  </body>
</html>
